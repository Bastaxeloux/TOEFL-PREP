<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEFL Task 2 - Campus Announcement</title>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.png') }}?v=2">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div id="app" class="toefl-container">
        <!-- Setup Screen -->
        <div id="setupScreen" class="screen">
            <div class="header-logo-container">
                <img src="{{ url_for('static', filename='favicon.png') }}" alt="TOEFL Logo" class="page-logo">
            </div>
            <h1 class="toefl-header">Task 2: Campus Announcement</h1>

            <div class="task-instructions">
                <p><strong>Format:</strong> Read (50s) → Listen (~60s) → Prepare (30s) → Speak (60s)</p>
                <p>You will read a short announcement, listen to a conversation about it, then speak about the students' opinion.</p>
            </div>

            <div class="config-section">
                <div class="config-item">
                    <label for="apiKey">OpenAI API Key (required for evaluation):</label>
                    <div class="api-key-input-group">
                        <input type="password" id="apiKey" placeholder="sk-..." value="{{ api_key }}">
                        <button id="saveApiKeyBtn" class="btn btn-success btn-compact">Save</button>
                    </div>
                </div>

                <div class="config-item">
                    <label for="promptSelect">Select Prompt:</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <select id="promptSelect" style="flex: 1; padding: 8px; font-size: 14px; border: 2px solid #333; border-radius: 4px;">
                            <option value="">-- Random Prompt --</option>
                        </select>
                        <button id="newPromptBtn" class="btn btn-success" style="white-space: nowrap;">New Prompt</button>
                        <button id="editPromptBtn" class="btn" style="background-color: #007bff; color: white; white-space: nowrap;">Edit</button>
                    </div>
                </div>

                <div class="config-item">
                    <label>Reading Passage:</label>
                    <div id="readingDisplay" style="padding: 15px; background-color: #f5f5f5; border: 2px solid #ccc; border-radius: 4px; min-height: 150px; white-space: pre-wrap; font-family: inherit; line-height: 1.6; color: #333;">
                        <em style="color: #999;">Select a prompt to view its content</em>
                    </div>
                </div>

                <div class="config-item">
                    <label>Associated Audio:</label>
                    <div id="audioDisplay" style="padding: 10px; background-color: #f5f5f5; border: 2px solid #ccc; border-radius: 4px; color: #666;">
                        <em>No audio selected</em>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button id="startTaskButton" class="btn btn-primary btn-highlight">Start Task</button>
                <button onclick="window.location.href='/other-tasks'" class="btn btn-warning">Back to Task Menu</button>
            </div>
            <div id="saveMessage" class="save-message"></div>
        </div>

        <!-- Practice Screen -->
        <div id="practiceScreen" class="screen" style="display: none;">
            <h1 class="toefl-header">Task 2: Campus Announcement</h1>

            <!-- Reading Phase -->
            <div id="readingPhase" class="phase-section" style="display: none;">
                <h2>Reading Time: <span id="readingTimer">50</span>s</h2>
                <div class="reading-passage" id="readingPassage"></div>
            </div>

            <!-- Listening Phase -->
            <div id="listeningPhase" class="phase-section" style="display: none;">
                <h2>Listen to the conversation</h2>
                <audio id="conversationAudio" controls></audio>
                <p class="instruction-text">Click play when ready. The preparation timer will start when the audio finishes.</p>
            </div>

            <!-- No Audio Phase -->
            <div id="noAudioPhase" class="phase-section" style="display: none;">
                <h2>No Audio Available</h2>
                <p class="instruction-text">You didn't upload an audio file. You can proceed to preparation and recording, but the AI evaluation will focus on vocabulary, grammar, and phrasing rather than content accuracy.</p>
                <button id="continueWithoutAudio" class="btn btn-primary">Continue to Preparation</button>
            </div>

            <!-- Preparation Phase -->
            <div id="preparationPhase" class="phase-section" style="display: none;">
                <h2>Preparation Time</h2>
                <div class="timer-container">
                    <div class="timer">
                        <span id="prepTimer">30</span>
                    </div>
                </div>
            </div>

            <!-- Recording Phase -->
            <div id="recordingPhase" class="phase-section" style="display: none;">
                <h2>Speaking Time: <span id="speakingTimer">60</span>s</h2>
                <div class="recording-indicator">Recording in progress...</div>
            </div>

            <!-- Results Phase -->
            <div id="resultsPhase" class="phase-section" style="display: none;">
                <h2>Your Response</h2>
                <div id="recordedAudioContainer"></div>
                <div id="transcriptionResults" class="progress-container"></div>
                <div class="button-container">
                    <button id="resetButton" class="btn btn-warning">Try Again</button>
                    <button onclick="window.location.href='/other-tasks'" class="btn btn-primary">Back to Task Menu</button>
                </div>
            </div>
        </div>

        <!-- Modal for creating/editing prompts -->
        <div id="promptModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">New Prompt</h2>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="config-item">
                        <label for="modalReadingText">Reading Passage:</label>
                        <textarea id="modalReadingText" rows="8" placeholder="Paste the reading passage here..."></textarea>
                    </div>
                    <div class="config-item">
                        <label for="modalAudioSelect">Conversation Audio:</label>
                        <div style="margin-bottom: 10px;">
                            <select id="modalAudioSelect" style="width: 100%; padding: 8px; font-size: 14px; border: 2px solid #333; border-radius: 4px;">
                                <option value="">-- Select existing audio or upload new --</option>
                            </select>
                        </div>
                        <label for="modalAudioUpload" style="font-weight: normal; color: #666;">Or upload new audio file:</label>
                        <input type="file" id="modalAudioUpload" accept="audio/*">
                        <div id="modalAudioStatus" class="audio-status"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="modalDeleteBtn" class="btn" style="background-color: #dc3545; color: white; margin-right: auto;">Delete</button>
                    <button id="modalCancelBtn" class="btn">Cancel</button>
                    <button id="modalSaveBtn" class="btn btn-success">Save Prompt</button>
                </div>
            </div>
        </div>

        <div class="github-link">
            <p>Open source project - <a href="https://github.com/Bastaxeloux/TOEFL-PREP" target="_blank">View on GitHub</a></p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='task2.js') }}"></script>
</body>
</html>
